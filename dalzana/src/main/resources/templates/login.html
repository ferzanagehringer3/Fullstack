<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Page</title>

  <link rel="stylesheet" th:href="@{/css/main.css}" href="/css/main.css">
  <link rel="stylesheet" th:href="@{/css/login.css}" href="/css/login.css">
</head>

<body class="login-page">
  <div class="login-container">
    <h1 class="page-title">DalZana Connect</h1>

    <form id="registerForm">
      <div class="form-group">
        <label for="name">Name und Nachname</label>
        <input type="text" id="name" name="name" placeholder="Enter your name and surname" required>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required>
      </div>

      <div class="form-group">
        <label class="form-section-title">FÃ¤higkeiten</label>
      </div>
  </div>

  <div class="form-group">
    <label for="role">Role</label>
    <select id="role" name="role" required>
      <option value="">-- Select a role" --</option>
      <option value="user">User</option>
      <option value="admin">Admin</option>
      <option value="moderator">Moderator</option>
    </select>
  </div>

  <p id="formError" style="display:none; margin-top:12px;"></p>
  <button id="submitBtn" type="submit">Submit</button>
  </form>
  </div>

  <script>
    const form = document.getElementById("registerForm");
    const errorEl = document.getElementById("formError");
    const submitBtn = document.getElementById("submitBtn");

    function showError(msg) {
      errorEl.style.display = "block";
      errorEl.textContent = msg;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorEl.style.display = "none";

      submitBtn.disabled = true;

      const firstName = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const role = document.getElementById("role").value;

      const selectedSkill = document.querySelector("input[name='skills']:checked")?.value;
      const skillName = selectedSkill ? (skillMap[selectedSkill] || selectedSkill) : null;

      try {
        const res = await fetch("/api/users/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || `HTTP ${res.status}`);
        }

        const createdUser = await res.json();

        window.location.href = "/home";
      } catch (err) {
        showError("Konnte User nicht erstellen: " + err.message);
      } finally {
        submitBtn.disabled = false;
      }
    });

  </script>
</body>

</html>