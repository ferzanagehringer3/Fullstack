<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DalZana Connect</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    .app { height: 100vh; display: flex; }
    .left { width: 240px; border-right: 1px solid #ddd; padding: 12px; overflow-y: auto; }
    .main { flex: 1; padding: 12px; display: flex; flex-direction: column; }
    .teams .team-row { display: flex; align-items: center; gap: 6px; margin: 6px 0; }
    .teams button.team { flex: 1; padding: 8px; text-align: left; }
    .teams .team-actions { display: flex; gap: 4px; }
    .teams .team-actions a, .teams .team-actions button { padding: 6px 8px; font-size: 12px; }
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding-bottom: 10px; gap: 12px; }
    .team-title { display: flex; flex-direction: column; gap: 4px; }
    .team-members { font-size: 12px; color: #888; }
    .team-members a { color: #888; text-decoration: none; }
    .team-members a:hover { text-decoration: underline; }
    .header-actions { display: flex; align-items: center; gap: 8px; margin-left: auto; }
    .chat { flex: 1; padding: 12px 0; overflow: auto; }
    .msg { margin: 6px 0; }
    .composer { display: flex; gap: 8px; border-top: 1px solid #ddd; padding-top: 10px; }
    input[type="text"] { flex: 1; padding: 8px; }
    .form-group { margin: 12px 0; }
    .form-group label { display: block; font-weight: bold; margin-bottom: 4px; }
    .form-group input, .form-group select { width: 100%; padding: 6px; box-sizing: border-box; }
    .form-group button { background: #28a745; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 8px; }
    .form-group button:hover { background: #218838; }
    .message { padding: 10px; border-radius: 4px; margin-bottom: 10px; }
    .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .create-team { background: #f5f5f5; padding: 12px; border-radius: 4px; margin-bottom: 12px; }
    .add-member { background: #f5f5f5; padding: 12px; border-radius: 4px; margin-bottom: 12px; }
  </style>
</head>

<body>
  <div class="app">
    <!-- LEFT: Teams -->
    <div class="left">
      <h3>Teams</h3>

      <!-- Create Team Button -->
      <div style="margin-bottom: 12px;">
        <a href="/teams/create" style="text-decoration: none;">
          <button style="width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
            + Neues Team erstellen
          </button>
        </a>
      </div>

      <!-- Team List -->
      <div class="teams" id="teamList">
        <div th:if="${#lists.isEmpty(teams)}">Keine Teams vorhanden</div>
        <div th:each="t : ${teams}" class="team-row">
          <button class="team"
                  th:data-team-id="${t.id}"
                  th:data-team-name="${t.name}"
                  th:data-team-members="${#strings.listJoin(t.members.![name], ', ')}"
                  th:text="${t.name}">
            Team
          </button>
          <div class="team-actions">
            <a th:href="@{/teams/{id}/edit(id=${t.id})}" style="text-decoration:none;">
              <button type="button">Bearbeiten</button>
            </a>
            <form th:action="@{/teams/{id}/delete(id=${t.id})}" method="post" onsubmit="return confirm('Team wirklich löschen?');">
              <button type="submit" style="background:#dc3545;color:#fff;border:none;border-radius:4px;">Löschen</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- CENTER: Chat -->
    <div class="main">
      <div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage}" class="message error" th:text="${errorMessage}"></div>

      <div class="header">
        <div class="team-title">
          <h2 id="teamTitle" th:if="${!#lists.isEmpty(teams)}" th:text="${teams[0].name}">Team</h2>
          <h2 id="teamTitle" th:if="${#lists.isEmpty(teams)}">Kein Team</h2>

          <div class="team-members" th:if="${!#lists.isEmpty(teams)}">
            <a id="teamMembersLink"
               th:href="@{/teams/{id}(id=${teams[0].id})}"
               th:text="${#strings.listJoin(teams[0].members.![name], ', ')}">Mitglieder</a>
          </div>
          <div class="team-members" th:if="${#lists.isEmpty(teams)}">Keine Mitglieder</div>
        </div>

        <div class="header-actions">
          <a id="filesLink"
             th:if="${!#lists.isEmpty(teams)}"
             th:href="@{/teams/{teamId}/files(teamId=${teams[0].id})}"
             style="text-decoration: none;">
            <button id="filesBtn">Files</button>
          </a>
          <button id="filesBtn" th:if="${#lists.isEmpty(teams)}" disabled>Files</button>

          <a id="logoutLink" th:href="@{/logout}" style="text-decoration: none;">
            <button id="logoutBtn">Logout</button>
          </a>
        </div>
      </div>

      <!-- Add Member Form -->
      <div class="add-member" th:if="${!#lists.isEmpty(teams)}">
        <div class="msg"><b>Bob:</b> Hi!</div>
      </div>

      <form class="composer" id="chatForm">
        <input id="messageInput" type="text" placeholder="Type a message..." />
        <button type="submit">Send</button>
      </form>
    </div>
  </div>



  <script>
    // Switch team title + files link
    document.getElementById("teamList").addEventListener("click", (e) => {
      const btn = e.target.closest(".team");
      if (!btn) return;

      const teamName = btn.dataset.teamName;
      const teamId = btn.dataset.teamId;
      const teamMembers = btn.dataset.teamMembers || '';

      if (teamName) {
        document.getElementById("teamTitle").textContent = teamName;
      }

      const filesLink = document.getElementById("filesLink");
      if (filesLink && teamId) {
        filesLink.setAttribute("href", `/teams/${teamId}/files`);
      }

      const membersLink = document.getElementById("teamMembersLink");
      if (membersLink && teamId) {
        membersLink.setAttribute("href", `/teams/${teamId}`);
        membersLink.textContent = teamMembers || 'Keine Mitglieder';
      }
    });

    // Send message (mock)
    document.getElementById("chatForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const input = document.getElementById("messageInput");
      const text = input.value.trim();
      if (!text) return;

      const msg = document.createElement("div");
      msg.className = "msg";
      msg.innerHTML = "<b>You:</b> " + text;

      const box = document.getElementById("chatBox");
      box.appendChild(msg);
      box.scrollTop = box.scrollHeight;
      input.value = "";
    });

    // Files button links to selected team
  </script>
</body>
</html>
